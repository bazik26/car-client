<div class="search-page py-3">
  <div class="row">
    <div class="col-xl-3 col-lg-4 col-md-12">
      @if (form && BRANDS_AND_MODELS) {
        <form [formGroup]="form">
          <div class="form-control">
            <div class="form-group">
              <label class="form-label">Марка</label>
              <ng-select
                [items]="brands"
                bindLabel="title"
                bindValue="title"
                placeholder="Выберите марку"
                [searchable]="true"
                formControlName="brand"
                (clear)="clearControl('brand')">
                >
              </ng-select>
            </div>

            <div class="mt-3 form-group">
              <label class="form-label">Модель</label>
              <ng-select
                [items]="models"
                bindLabel="title"
                bindValue="title"
                placeholder="Выберите модель"
                [searchable]="true"
                formControlName="model"
                (clear)="clearControl('model')">
                >
              </ng-select>
            </div>

            <div class="mt-3 row">
              <div class="col">
                <label class="form-label">Цена от</label>
                <input
                  type="number"
                  class="form-control"
                  formControlName="priceStart"
                />
              </div>

              <div class="col">
                <label class="form-label">Цена до</label>
                <input
                  type="number"
                  class="form-control"
                  formControlName="priceEnd"
                />
              </div>
            </div>

            <!-- Кнопка для мобильных - показать/скрыть дополнительные фильтры -->
            <div class="d-md-none mt-3">
              <button 
                type="button" 
                class="btn btn-outline-warning w-100"
                (click)="toggleAdvancedFilters()">
                <i class="fas" [class.fa-chevron-down]="!showAdvancedFilters" [class.fa-chevron-up]="showAdvancedFilters"></i>
                {{ showAdvancedFilters ? 'Скрыть фильтры' : 'Дополнительные фильтры' }}
              </button>
            </div>

            <!-- Дополнительные фильтры (скрыты на мобильных по умолчанию) -->
            <div class="advanced-filters" [class.d-none]="!showAdvancedFilters" [class.d-md-block]="true">
              <div class="mt-3 year-fields">
                <div class="form-group">
                  <label class="form-label">Год от</label>
                  <input
                    type="number"
                    class="form-control"
                    formControlName="yearStart"
                  />
                </div>

                <div class="form-group">
                  <label class="form-label">Год до</label>
                  <input
                    type="number"
                    class="form-control"
                    formControlName="yearEnd"
                  />
                </div>
              </div>

              <div class="mt-3 form-group">
                <label class="form-label">Коробка передач</label>
                <ng-select
                  [items]="gearboxes"
                  [multiple]="true"
                  [searchable]="true"
                  placeholder="Выберите коробку"
                  formControlName="gearbox"
                >
                </ng-select>
              </div>

              <div class="mt-3 form-group">
                <label class="form-label">Топливо</label>
                <ng-select
                  [items]="fuels"
                  [multiple]="true"
                  [searchable]="true"
                  placeholder="Выберите топливо"
                  formControlName="fuel"
                >
                </ng-select>
              </div>

              <div class="mt-3 form-group">
                <label class="form-label">Привод</label>
                <ng-select
                  [items]="drives"
                  [multiple]="true"
                  [searchable]="true"
                  placeholder="Выберите привод"
                  formControlName="drive"
                >
                </ng-select>
              </div>

              @for (group of options; track group) {
                <div class="form-group mt-3">
                  <label class="form-label">{{ group.title }}</label>
                  <ng-select
                    [items]="group.values"
                    [multiple]="true"
                    [searchable]="true"
                    placeholder="Выберите"
                    formControlName="{{ group.controlName }}"
                  >
                  </ng-select>
                </div>
              }
            </div>
          </div>
        </form>
      }
    </div>

    <div class="col-xl-9 col-lg-8 col-md-12">
      <!-- Информация о результатах -->
      @if (pagination) {
        <div class="search-results-header mb-3">
          <p class="results-count">
            Найдено автомобилей: <span class="highlight">{{ pagination.total }}</span> 
            (страница {{ pagination.page }} из {{ pagination.totalPages }})
          </p>
        </div>
      }

      <!-- Список автомобилей -->
      <div class="row">
        @for (car of cars; track car?.id ?? $index) {
          <div class="mt-3 col-xl-3 col-lg-4 col-md-6 col-12">
            <app-car-item [car]="car"></app-car-item>
          </div>
        }
      </div>

      <!-- Пагинация -->
      @if (pagination && pagination.totalPages > 1) {
        <div class="pagination-container mt-4">
          <nav aria-label="Навигация по страницам">
            <ul class="pagination justify-content-center">
              <!-- Предыдущая страница -->
              <li class="page-item" [class.disabled]="!pagination.hasPrev">
                <button class="page-link" (click)="prevPage()" [disabled]="!pagination.hasPrev">
                  <i class="fas fa-chevron-left"></i>
                </button>
              </li>

              <!-- Номера страниц -->
              @for (pageNum of pageNumbers; track pageNum) {
                <li class="page-item" [class.active]="pageNum === pagination.page">
                  <button class="page-link" (click)="goToPage(pageNum)">
                    {{ pageNum }}
                  </button>
                </li>
              }

              <!-- Следующая страница -->
              <li class="page-item" [class.disabled]="!pagination.hasNext">
                <button class="page-link" (click)="nextPage()" [disabled]="!pagination.hasNext">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      }

      <!-- Сообщение если нет результатов -->
      @if (cars.length === 0 && pagination) {
        <div class="no-results text-center py-5">
          <i class="fas fa-search fa-3x text-muted mb-3"></i>
          <h4>Автомобили не найдены</h4>
          <p class="text-muted">Попробуйте изменить параметры поиска</p>
        </div>
      }
    </div>
  </div>
</div>
