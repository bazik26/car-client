@if (hasAccess && themeForm && currentTheme) {
  <div class="admin-page">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="page-header">
            <h2 class="page-title">
              <i class="fas fa-palette me-2"></i>
              Расширенная кастомизация дизайна
              <span class="beta-badge">BETA</span>
            </h2>
            <p class="page-subtitle">Полная настройка внешнего вида сайта с live-предпросмотром</p>
            <div class="beta-notice">
              <i class="fas fa-flask me-2"></i>
              <strong>Тестовая версия</strong> - этот модуль находится в разработке и доступен только супер администраторам.
              <br><br>
              <strong>Как работает сохранение:</strong>
              <ul class="mt-2 mb-0">
                <li>Все изменения применяются <strong>в реальном времени</strong> при вводе</li>
                <li>Настройки автоматически сохраняются в <strong>localStorage</strong> браузера</li>
                <li>Кнопка "Сохранить" подтверждает изменения</li>
                <li>Кнопка "Сбросить" возвращает к настройкам по умолчанию</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Настройки кастомизации -->
        <div class="col-lg-4 mb-4">
          <div class="theme-section">
            <div class="section-header">
              <h4 class="section-title">
                <i class="fas fa-sliders-h me-2"></i>
                Настройки дизайна
              </h4>
            </div>
            
            <!-- Вкладки -->
            <div class="customization-tabs">
              <button 
                class="tab-button"
                [class.active]="isTabActive('colors')"
                (click)="setActiveTab('colors')"
              >
                <i class="fas fa-palette me-1"></i>Цвета
              </button>
              <button 
                class="tab-button"
                [class.active]="isTabActive('fonts')"
                (click)="setActiveTab('fonts')"
              >
                <i class="fas fa-font me-1"></i>Шрифты
              </button>
              <button 
                class="tab-button"
                [class.active]="isTabActive('images')"
                (click)="setActiveTab('images')"
              >
                <i class="fas fa-image me-1"></i>Изображения
              </button>
              <button 
                class="tab-button"
                [class.active]="isTabActive('layout')"
                (click)="setActiveTab('layout')"
              >
                <i class="fas fa-th me-1"></i>Макет
              </button>
              <button 
                class="tab-button"
                [class.active]="isTabActive('animations')"
                (click)="setActiveTab('animations')"
              >
                <i class="fas fa-magic me-1"></i>Анимации
              </button>
              <button 
                class="tab-button"
                [class.active]="isTabActive('advanced')"
                (click)="setActiveTab('advanced')"
              >
                <i class="fas fa-cogs me-1"></i>Дополнительно
              </button>
            </div>

            <form [formGroup]="themeForm" class="custom-theme-form">
              <!-- Вкладка Цвета -->
              @if (isTabActive('colors')) {
                <div class="tab-content">
                  <h5 class="tab-title">Цветовая схема</h5>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Основной цвет</label>
                      <div class="color-input-group">
                        <input 
                          type="color" 
                          class="form-control color-picker"
                          formControlName="primaryColor"
                        />
                        <input 
                          type="text" 
                          class="form-control color-text"
                          formControlName="primaryColor"
                          placeholder="#217e02"
                        />
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Вторичный цвет</label>
                      <div class="color-input-group">
                        <input 
                          type="color" 
                          class="form-control color-picker"
                          formControlName="secondaryColor"
                        />
                        <input 
                          type="text" 
                          class="form-control color-text"
                          formControlName="secondaryColor"
                          placeholder="#1a6b02"
                        />
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Акцентный цвет</label>
                      <div class="color-input-group">
                        <input 
                          type="color" 
                          class="form-control color-picker"
                          formControlName="accentColor"
                        />
                        <input 
                          type="text" 
                          class="form-control color-text"
                          formControlName="accentColor"
                          placeholder="#28a745"
                        />
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Цвет фона</label>
                      <div class="color-input-group">
                        <input 
                          type="color" 
                          class="form-control color-picker"
                          formControlName="backgroundColor"
                        />
                        <input 
                          type="text" 
                          class="form-control color-text"
                          formControlName="backgroundColor"
                          placeholder="#1a1a1a"
                        />
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Цвет текста</label>
                      <div class="color-input-group">
                        <input 
                          type="color" 
                          class="form-control color-picker"
                          formControlName="textColor"
                        />
                        <input 
                          type="text" 
                          class="form-control color-text"
                          formControlName="textColor"
                          placeholder="#ffffff"
                        />
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Фон карточек</label>
                      <div class="color-input-group">
                        <input 
                          type="color" 
                          class="form-control color-picker"
                          formControlName="cardBackground"
                        />
                        <input 
                          type="text" 
                          class="form-control color-text"
                          formControlName="cardBackground"
                          placeholder="#2d2d2d"
                        />
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Цвет ссылок</label>
                      <div class="color-input-group">
                        <input 
                          type="color" 
                          class="form-control color-picker"
                          formControlName="linkColor"
                        />
                        <input 
                          type="text" 
                          class="form-control color-text"
                          formControlName="linkColor"
                          placeholder="#217e02"
                        />
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Цвет ссылок (наведение)</label>
                      <div class="color-input-group">
                        <input 
                          type="color" 
                          class="form-control color-picker"
                          formControlName="linkHoverColor"
                        />
                        <input 
                          type="text" 
                          class="form-control color-text"
                          formControlName="linkHoverColor"
                          placeholder="#1a6b02"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              }

              <!-- Вкладка Шрифты -->
              @if (isTabActive('fonts')) {
                <div class="tab-content">
                  <h5 class="tab-title">Настройки шрифтов</h5>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Основной шрифт</label>
                      <select class="form-select" formControlName="primaryFont">
                        @for (font of availableFonts; track font.value) {
                          <option [value]="font.value">{{ font.name }}</option>
                        }
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Шрифт заголовков</label>
                      <select class="form-select" formControlName="headingFont">
                        @for (font of availableFonts; track font.value) {
                          <option [value]="font.value">{{ font.name }}</option>
                        }
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Размер шрифта</label>
                      <select class="form-select" formControlName="fontSize">
                        <option value="small">Маленький (14px)</option>
                        <option value="medium">Средний (16px)</option>
                        <option value="large">Большой (18px)</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Жирность шрифта</label>
                      <select class="form-select" formControlName="fontWeight">
                        <option value="light">Тонкий (300)</option>
                        <option value="normal">Обычный (400)</option>
                        <option value="bold">Жирный (600)</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Размер заголовков</label>
                      <select class="form-select" formControlName="headingSize">
                        <option value="small">Маленький (1.25rem)</option>
                        <option value="medium">Средний (1.5rem)</option>
                        <option value="large">Большой (1.75rem)</option>
                        <option value="xl">Очень большой (2rem)</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Межстрочный интервал</label>
                      <select class="form-select" formControlName="lineHeight">
                        <option value="tight">Плотный (1.2)</option>
                        <option value="normal">Обычный (1.5)</option>
                        <option value="loose">Свободный (1.8)</option>
                      </select>
                    </div>
                  </div>
                </div>
              }

              <!-- Вкладка Изображения -->
              @if (isTabActive('images')) {
                <div class="tab-content">
                  <h5 class="tab-title">Настройки изображений</h5>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Стиль изображений</label>
                      <select class="form-select" formControlName="imageStyle">
                        <option value="rounded">Скругленные</option>
                        <option value="square">Квадратные</option>
                        <option value="circle">Круглые</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Радиус скругления (px)</label>
                      <input 
                        type="number" 
                        class="form-control"
                        formControlName="imageBorderRadius"
                        min="0"
                        max="50"
                      />
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Прозрачность (0-1)</label>
                      <input 
                        type="range" 
                        class="form-range"
                        formControlName="imageOpacity"
                        min="0"
                        max="1"
                        step="0.1"
                      />
                      <small class="text-muted">{{ currentTheme.imageOpacity }}</small>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Фильтр изображений</label>
                      <select class="form-select" formControlName="imageFilter">
                        <option value="none">Без фильтра</option>
                        <option value="grayscale">Черно-белый</option>
                        <option value="sepia">Сепия</option>
                        <option value="blur">Размытие</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <div class="form-check">
                        <input 
                          class="form-check-input" 
                          type="checkbox" 
                          formControlName="imageShadow"
                          id="imageShadow"
                        />
                        <label class="form-check-label" for="imageShadow">
                          Тень у изображений
                        </label>
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <div class="form-check">
                        <input 
                          class="form-check-input" 
                          type="checkbox" 
                          formControlName="imageHoverEffect"
                          id="imageHoverEffect"
                        />
                        <label class="form-check-label" for="imageHoverEffect">
                          Эффект при наведении
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              }

              <!-- Вкладка Макет -->
              @if (isTabActive('layout')) {
                <div class="tab-content">
                  <h5 class="tab-title">Настройки макета</h5>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Стиль макета</label>
                      <select class="form-select" formControlName="layoutStyle">
                        <option value="compact">Компактный</option>
                        <option value="spacious">Просторный</option>
                        <option value="minimal">Минималистичный</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Отступы в карточках</label>
                      <select class="form-select" formControlName="cardPadding">
                        <option value="small">Маленькие (12px)</option>
                        <option value="medium">Средние (20px)</option>
                        <option value="large">Большие (32px)</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Расстояние между карточками</label>
                      <select class="form-select" formControlName="cardSpacing">
                        <option value="tight">Плотно (8px)</option>
                        <option value="normal">Обычно (16px)</option>
                        <option value="loose">Свободно (24px)</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Скругление углов</label>
                      <select class="form-select" formControlName="borderRadius">
                        <option value="none">Без скругления</option>
                        <option value="small">Маленькое (4px)</option>
                        <option value="medium">Среднее (8px)</option>
                        <option value="large">Большое (16px)</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Максимальная ширина контейнера</label>
                      <select class="form-select" formControlName="containerMaxWidth">
                        <option value="small">Маленькая (768px)</option>
                        <option value="medium">Средняя (992px)</option>
                        <option value="large">Большая (1200px)</option>
                        <option value="xl">Очень большая (1400px)</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Количество колонок в сетке</label>
                      <select class="form-select" formControlName="gridColumns">
                        <option value="1">1 колонка</option>
                        <option value="2">2 колонки</option>
                        <option value="3">3 колонки</option>
                        <option value="4">4 колонки</option>
                      </select>
                    </div>
                  </div>
                </div>
              }

              <!-- Вкладка Анимации -->
              @if (isTabActive('animations')) {
                <div class="tab-content">
                  <h5 class="tab-title">Настройки анимаций</h5>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <div class="form-check">
                        <input 
                          class="form-check-input" 
                          type="checkbox" 
                          formControlName="animationsEnabled"
                          id="animationsEnabled"
                        />
                        <label class="form-check-label" for="animationsEnabled">
                          Включить анимации
                        </label>
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <div class="form-check">
                        <input 
                          class="form-check-input" 
                          type="checkbox" 
                          formControlName="hoverEffects"
                          id="hoverEffects"
                        />
                        <label class="form-check-label" for="hoverEffects">
                          Эффекты при наведении
                        </label>
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <div class="form-check">
                        <input 
                          class="form-check-input" 
                          type="checkbox" 
                          formControlName="pageTransitions"
                          id="pageTransitions"
                        />
                        <label class="form-check-label" for="pageTransitions">
                          Переходы между страницами
                        </label>
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Скорость анимаций</label>
                      <select class="form-select" formControlName="animationSpeed">
                        <option value="slow">Медленно (0.5s)</option>
                        <option value="normal">Обычно (0.3s)</option>
                        <option value="fast">Быстро (0.15s)</option>
                      </select>
                    </div>
                  </div>
                </div>
              }

              <!-- Вкладка Дополнительно -->
              @if (isTabActive('advanced')) {
                <div class="tab-content">
                  <h5 class="tab-title">Дополнительные стили</h5>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label class="form-label">Стиль кнопок</label>
                      <select class="form-select" formControlName="buttonStyle">
                        <option value="flat">Плоские</option>
                        <option value="raised">Приподнятые</option>
                        <option value="outlined">С обводкой</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Размер кнопок</label>
                      <select class="form-select" formControlName="buttonSize">
                        <option value="small">Маленькие</option>
                        <option value="medium">Средние</option>
                        <option value="large">Большие</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Стиль полей ввода</label>
                      <select class="form-select" formControlName="inputStyle">
                        <option value="flat">Плоские</option>
                        <option value="outlined">С обводкой</option>
                        <option value="filled">Заполненные</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Интенсивность теней</label>
                      <select class="form-select" formControlName="shadowIntensity">
                        <option value="none">Без теней</option>
                        <option value="light">Легкие</option>
                        <option value="medium">Средние</option>
                        <option value="heavy">Сильные</option>
                      </select>
                    </div>

                    <div class="col-md-6 mb-3">
                      <div class="form-check">
                        <input 
                          class="form-check-input" 
                          type="checkbox" 
                          formControlName="gradientEnabled"
                          id="gradientEnabled"
                        />
                        <label class="form-check-label" for="gradientEnabled">
                          Включить градиенты
                        </label>
                      </div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label">Направление градиента</label>
                      <select class="form-select" formControlName="gradientDirection">
                        <option value="horizontal">Горизонтальный</option>
                        <option value="vertical">Вертикальный</option>
                        <option value="diagonal">Диагональный</option>
                      </select>
                    </div>
                  </div>
                </div>
              }

              <div class="form-actions">
                <button 
                  type="button" 
                  class="btn btn-primary"
                  (click)="saveTheme()"
                  [disabled]="themeForm.invalid"
                >
                  <i class="fas fa-save me-2"></i>
                  Сохранить настройки
                </button>
                
                <button 
                  type="button" 
                  class="btn btn-outline-secondary"
                  (click)="resetToDefault()"
                >
                  <i class="fas fa-undo me-2"></i>
                  Сбросить к умолчанию
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Большой предпросмотр макета -->
        <div class="col-lg-8 mb-4">
          <div class="theme-section">
            <h4 class="section-title">
              <i class="fas fa-eye me-2"></i>
              Live-предпросмотр макета
            </h4>
            
            <div class="layout-preview">
              <!-- Предпросмотр главной страницы -->
              <div class="preview-page">
                <div class="preview-header">
                  <h3>Главная страница</h3>
                  <div class="preview-nav">
                    <span class="nav-item active">Главная</span>
                    <span class="nav-item">Автомобили</span>
                    <span class="nav-item">О нас</span>
                  </div>
                </div>
                
                <div class="preview-content">
                  <div class="preview-hero">
                    <h1>Добро пожаловать в наш автосалон</h1>
                    <p>Лучшие автомобили по доступным ценам</p>
                    <button class="preview-btn">Посмотреть каталог</button>
                  </div>
                  
                  <div class="preview-cars-grid">
                    <h2>Популярные автомобили</h2>
                    <div class="cars-grid">
                      @for (car of [1,2,3,4,5,6]; track car) {
                        <div class="preview-car-card">
                          <div class="preview-car-image">
                            <div class="image-placeholder">BMW X5</div>
                          </div>
                          <div class="preview-car-info">
                            <h4>BMW X5 2023</h4>
                            <div class="preview-specs">
                              <span><i class="fas fa-tachometer-alt"></i> 45 000 км</span>
                              <span><i class="fas fa-cog"></i> 3.0 л</span>
                              <span><i class="fas fa-bolt"></i> 340 л.с.</span>
                            </div>
                            <div class="preview-price">2 500 000 ₽</div>
                            <button class="preview-btn-small">Подробнее</button>
                          </div>
                        </div>
                      }
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
}